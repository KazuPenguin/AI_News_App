# 🚀 AI Research OS: 開発ロードマップ

## Phase 1: 構想・要件定義（Foundation）
プロジェクトの方向性と「やらないこと」を明確にし、技術選定の根拠を固めます。

- [2026/1/19] **非機能要件 & 技術選定 (ADR)**
    - 目標レスポンス時間、最大許容コスト、想定ユーザー数の策定
    - 技術スタック確定と選定理由の記録（なぜ Cognito/Fastlane なのか等）
- [2026/1/19] **ユーザーモデル & 多言語方針の策定**
    - プロフィール項目（興味タグ、購読レベル、言語設定）の定義
    - 対応言語の範囲と、翻訳リソース（辞書ファイル vs AI翻訳）の決定
- [2026/2/11] **論文キュレーション要件の確定**
    - 6大カテゴリ（基盤モデル / 学習 / エンジニアリング / インフラ / 評価 / 規制）の定義
    - KGI策定：トークンコスト最小化 & Recall確保（ファンネル型アーキテクチャ）
    - 3段階フィルタリング（L1: Keyword → L2: Vector → L3: LLM）設計方針の決定

---

## Phase 2: 設計（Design & Architecture）
UIからデータ構造、キュレーションパイプラインまでを一貫して設計し、開発時の「手戻り」を最小限にします。

- [2026/2/11] **UI/UX デザイン (Figma/Miro)**
    - ユーザーフロー図の作成（ゲスト/ログイン済みの分岐を含む）
    - ハイファイプロトタイプの作成（モバイル特有の操作、エラー表示、多言語レイアウト確認）
- [2026/2/11] **論文キュレーション・パイプライン設計**
    - **L1 収集設計:** arXiv API クエリ構成（対象カテゴリ: `cs.CL`, `cs.LG`, `cs.DC`, `cs.AI`, `cs.SE`, `cs.CR`, `cs.AR`, `cs.CY`）、キーワードOR結合ロジック
    - **L2 ベクトル選別設計:** アンカーベクトル6本の定義文作成、Embedding モデル選定（`text-embedding-3-small` 等）、コサイン類似度閾値（0.4目安）の決定
    - **L3 LLM分析設計:** 使用モデル選定（Gemini 1.5 Flash / gpt-4o-mini）、JSON Schema によるプロンプト出力仕様の確定
    - **バッチスケジューリング:** 実行タイミング（UTC arXiv更新後）、エラーハンドリング・リトライ方針
- [2026/2/11] **システム・データ設計**
    - **構成図作成:** AWS全体図（Lambda, RDS, Bedrock, Cognito）とセキュリティ境界
    - **DB物理設計:**
        - `papers` テーブル：書誌情報、Abstract、ベクトル（pgvector HNSW）、カテゴリID、適合度スコア、日本語要約、詳細解説、発行日、取得日時
        - `anchors` テーブル：カテゴリ定義文、アンカーベクトル（将来のカテゴリ追加に対応）
        - `users`, `bookmarks` 等のリレーション設計
    - **AIエージェント設計:** Gemini PDF全文分析方式の設計、プロンプト制御ロジック、3視点解説（AI・数学・ビジネス）のJSON Schema定義
- [2026/2/11] **API・認証仕様の確定 (OpenAPI)**
    - エンドポイント定義（TypeScript Interface）
    - 論文一覧API（カテゴリ/日付フィルタ、ページネーション）
    - Cognito Authorizer を利用した `Authorization` ヘッダー必須化の定義

---

## Phase 3: 開発基盤 & DevOps（Infrastructure）
自動化と監視環境を先に整え、実装スピードと品質を担保します。

- [2026/2/12] **IaC (AWS CDK) による環境構築**
    - VPC, S3, RDS (pgvector拡張有効化), Cognito (User Pool/Client) のコード定義とデプロイ
    - EventBridge / CloudWatch Events による日次バッチスケジュール設定
- [2026/2/19] **CI/CD パイプライン構築 (GitHub Actions)** (完了)
    - Linter/Formatter/Type Check の自動化
    - セキュリティスキャン (trufflehog) の導入
- [2026/2/19] **アプリケーション基盤の実装** (完了)
    - i18n (`react-i18next`) 導入と辞書ファイルのディレクトリ構造作成
    - 監視・オブザーバビリティ（CloudWatch Logs/Alarms）の設定
    - **キュレーション用ログ基盤:** L1/L2/L3 各フェーズの通過・除外数を記録する仕組み (`batch_logs` テーブル作成済)

---

## Phase 4: 実装 & 統合（Implementation）
キュレーションパイプラインを先に実装し、フロントエンドと統合します。

- [2026/2/19] **論文キュレーション・パイプラインの実装** (完了)
    - **Level 1 — データ収集:** arXiv API連携（6カテゴリ）、XMLパース、重複排除、レートリミット (`batch/l1_collector.py`)
    - **Level 2 — ベクトル選別:** OpenAI Embedding 一括生成、pgvector INSERT、コサイン類似度フィルタ (`batch/l2_selector.py`)
    - **Level 3 — LLM分析:** Gemini 2.0 Flash、JSON Mode、5並列、指数バックオフ (`batch/l3_analyzer.py`)
    - **パイプライン統合:** L1→L2→L3→Post-L3 の4段階オーケストレーション、batch_logs 記録 (`batch/pipeline.py`)
    - **Lambda Handler:** EventBridge トリガー対応 (`batch/handler.py`)
    - **設定:** 228行の定数・クエリ・プロンプト (`batch/config.py`)
    - **アンカー管理:** `anchors` テーブルへの初期データ投入スクリプト (`scripts/setup_anchors.py`)
    - **初期データシード:** デプロイ後の初回起動用データ投入スクリプト (`scripts/seed_papers.py`)
- [2026/2/19] **詳細解説生成エンジンの実装** (完了)
    - Gemini PDF全文分析: 3視点（AIエンジニア・数学・ビジネス）解説生成 (`batch/post_l3_reviewer.py`)
    - レベル別レビュー（初学者/中級/プロ）出力対応
    - PyMuPDF による図表抽出 → S3 アップロード
    - Pydantic モデル: `DetailReview`, `Section`, `Perspectives`, `Levels` (`utils/models.py`)
- [2026/2/19] **フロントエンド & 認証の実装** (基盤完了)
    - React Native (Expo Router) によるUI実装（ホーム/詳細/お気に入り/設定/ログイン）
    - NativeWind v4 (Tailwind CSS) によるスタイリング
    - AWS Amplify (Cognito) 認証統合
    - コンポーネント: `PaperCard`, `CategoryTab`
- [2026/2/20] **API エンドポイントの実装** (完了)
    - FastAPI + Mangum による全11エンドポイント実装 (`api/app.py`, `api/routers/`)
    - Pydantic レスポンス/リクエストモデル (`api/schemas.py`)
    - Cognito claims → ユーザー解決 + 初回自動作成 (`api/dependencies.py`)
    - 論文一覧 (カーソルページネーション, フィルタ), 論文詳細 (detail_review JSONB パース), 図表一覧, 閲覧記録 UPSERT
    - カテゴリ一覧 (論文数集計), ブックマーク CRUD (409重複/403権限チェック)
    - ユーザープロフィール, 設定部分更新, 統計 (閲覧数/ブックマーク数/最多閲覧カテゴリ)
    - 例外ハンドラ: HTTPException → `{"error": {"code", "message"}}`, ValidationError → 400, 汎用 → 500
    - テスト: 17件の API テスト (`test_api_papers.py`, `test_api_bookmarks.py`, `test_api_handler.py`)
    - Dockerfile に `utils/` ディレクトリの COPY を追加
- [2026/2/20] **Frontend-Backend 結合** (完了)
    - `@tanstack/react-query` 導入、`QueryClientProvider` でアプリ全体をラップ
    - API クライアント層: `lib/api-client.ts` (Cognito ID Token 付与), `lib/api.ts` (全11 API 関数 + 型定義)
    - React Query hooks: `hooks/usePapers.ts`, `hooks/useBookmarks.ts`, `hooks/useUser.ts`
    - 全画面をモックデータから実 API 呼び出しに書き換え:
        - ホーム: `useCategories()` + `usePapers()` (無限スクロール)
        - 論文詳細: `usePaperDetail()` + `useRecordView()` + ブックマーク操作、セクション/3視点/レベル別表示
        - お気に入り: `useBookmarks()` (無限スクロール)
        - 設定: `useUserProfile()` + `useUserStats()` + `useUpdateSettings()` (難易度サイクル変更)
    - `CategoryTab` → `{id, name}[]` + `selectedCategoryId` に props 変更
    - `PaperCard` → `{paper: PaperSummary}` に props 変更、重要度ラベル、閲覧済み半透明表示
- [ ] **パーソナライズ & 多言語対応の組み込み**
    - 興味タグに基づく推薦ロジックの実装
    - 言語設定に応じたエージェント出力の切り替え

---

## Phase 5: 検証・評価（QA & Evaluation）
AIの回答精度に加え、キュレーションパイプラインのフィルタ精度を定量的に評価します。

- [ ] **キュレーション・パイプライン評価**
    - L1→L2→L3 各段階の通過率測定（目標: L3到達率 10%以下）
    - アンカー類似度閾値のチューニング（Precision/Recall トレードオフ）
    - LLM分析の分類精度・要約品質の検証
    - 1日あたりのトークン消費量の計測とコスト最適化
- [ ] **RAG精度評価 (Eval)**
    - 代表的な論文に対する要約結果の検証
    - 日本語・英語それぞれでの出力形式と精度のテスト
- [ ] **統合テスト & ユーザー受入テスト**
    - アプリ起動から検索、AIレビュー閲覧までの全ルート疎通確認
    - モバイル実機でのパフォーマンス確認

---

## Phase 6: 運用・リリース（Deployment & Docs）
公開に必要な法的準備と、将来のチームのための記録を完了させます。

- [ ] **ドキュメントの完備**
    - [ ] README.md（セットアップ、環境変数、アーキテクチャ）の最終更新
    - [ ] ADR（技術選定のトレードオフ記録）の整理
    - [x] キュレーション運用ガイド（デプロイ等の運用開始マニュアル作成済: `設計/06_DevOps/operations_guide.md`）
- [ ] **法的準備 & リリース**
    - プライバシーポリシー・利用規約の作成
    - Fastlane を用いた TestFlight / Google Play への配信設定