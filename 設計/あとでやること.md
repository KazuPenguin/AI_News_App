# あとでやることリスト

開発フェーズと本番運用フェーズで実施すべきタスクを整理しました。

---

## 🚀 今すぐやる (開発フェーズで必要なタスク)

アプリケーション本体の開発を進めるために、**今すぐ着手・解決すべき**項目です。

### Secrets Manager (Batch/Auth 開発用)
開発に必要な外部APIキーや認証情報を登録します。
- [ ] **OpenAI API Key** を Secrets Manager に登録
  - `aws secretsmanager create-secret --name ai-research/openai-api-key --secret-string '{"api_key":"sk-xxx"}'`
- [ ] **Google AI Studio Key** を Secrets Manager に登録
  - `aws secretsmanager create-secret --name ai-research/gemini-api-key --secret-string '{"api_key":"xxx"}'`
- [ ] **Google OAuth クライアント ID / Secret** (未取得なら取得) → Secrets Manager に登録
- [ ] **Apple Sign In の Service ID / Key** (未取得なら取得) → Secrets Manager に登録

---

## ⏳ 後でやる (本番運用・リリース前のタスク)

機能開発が完了し、本番環境への移行やストア公開の準備段階で実施する項目です。

### 本番環境への移行時（CDK 設定変更）
- [ ] **`database-stack.ts`**: `removalPolicy` を `cdk.RemovalPolicy.RETAIN` に変更（DB 削除防止）
- [ ] **`database-stack.ts`**: `multiAz` を `true` に変更（高可用性）
- [ ] **`database-stack.ts`**: `deletionProtection` を `true` に変更
- [ ] **`database-stack.ts`**: インスタンスタイプを `db.t4g.small` 以上に変更
- [ ] **`network-stack.ts`**: `natGateways` を `2` に変更（AZ 冗長化）
- [ ] **`api-stack.ts`**: CORS `allowOrigins` を `ALL_ORIGINS` から本番ドメインに制限
- [ ] **`api-stack.ts`**: `dataTraceEnabled` が `false` であることを確認（リクエストボディのログ無効化）
- [ ] **`auth-stack.ts`**: メール送信を Cognito デフォルトから **SES** に切り替え（送信制限の緩和）
- [ ] **`auth-stack.ts`**: `callbackUrls` / `logoutUrls` を正式なカスタムスキームに更新（`myapp://` → 正式値）

### ネットワーク・セキュリティ強化
- [ ] **VPC Endpoints の追加検討** — NAT Gateway 経由のコスト削減
- [ ] **CloudFront にカスタムドメイン設定** — `cdn.example.com` 等（ACM 証明書の取得含む）
- [ ] **API Gateway にカスタムドメイン設定** — `api.example.com`（Route 53 + ACM 証明書）
- [ ] **WAF の追加検討** — CloudFront / API Gateway への Web ACL 設定

### AuthStack (ソーシャルログイン有効化)
Secrets Manager に登録したキーを使って CDK の設定を有効化します。
- [ ] **Google ソーシャルログインの有効化** — `auth-stack.ts` のコメントアウト解除
- [ ] **Apple ソーシャルログインの有効化** — `auth-stack.ts` のコメントアウト解除

### CI/CD (Phase 2 & 3: デプロイ・運用)
- [ ] **Frontend (Web)**: `infra` に Hosting 用スタック (S3 + CloudFront) を追加
- [ ] **Frontend (Web)**: GitHub Actions に Build & Deploy ジョブを追加
- [ ] **Frontend (Mobile)**: EAS (Expo Application Services) プロジェクトの初期化と CI 連携
- [ ] **E2E テスト**: Playwright 等を用いた統合テストの導入
- [ ] **監視/アラート**: 異常検知時の通知設定

### その他の運用課題
- [ ] **Lambda パッケージングの検討** — DockerImageFunction への移行検討
- [ ] **DLQ (Dead Letter Queue) の追加** — バッチ失敗時の通知・リトライ用
- [ ] **API キーの追加検討** — Usage Plan でクライアントアプリ単位のスロットリング

---

## ✅ デプロイ後の検証（最終確認）
- [ ] pgvector 拡張の有効化確認 (`SELECT * FROM pg_extension;`)
- [ ] EventBridge ルールの手動テスト実行
- [ ] Cognito テストユーザーでログインフロー確認
- [ ] API エンドポイントの疎通確認（`/health` で 200 応答）
- [ ] バッチ Lambda の手動実行テスト（`aws lambda invoke`）
