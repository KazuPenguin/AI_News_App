# あとでやること

CDK デプロイ後や開発中に手動対応が必要な作業をまとめる。

---

## 本番環境への移行時（CDK 設定変更）

- [ ] **`database-stack.ts`**: `removalPolicy` を `cdk.RemovalPolicy.RETAIN` に変更（DB 削除防止）
- [ ] **`database-stack.ts`**: `multiAz` を `true` に変更（高可用性）
- [ ] **`database-stack.ts`**: `deletionProtection` を `true` に変更
- [ ] **`database-stack.ts`**: インスタンスタイプを `db.t4g.small` 以上に変更
- [ ] **`network-stack.ts`**: `natGateways` を `2` に変更（AZ 冗長化）

---

## DatabaseStack 関連

- [ ] **pgvector 拡張の有効化** — RDS デプロイ後に実行
  ```sql
  psql -h <RDS_ENDPOINT> -U postgres -d ai_research
  CREATE EXTENSION IF NOT EXISTS vector;
  ```
  - 踏み台インスタンス or AWS CloudShell + SSM Session Manager 経由で接続
  - 確認: `SELECT * FROM pg_extension WHERE extname = 'vector';`
  - 将来的にはカスタムリソース (Lambda) で自動化を検討

- [ ] **初期スキーマ投入** — `database_schema.md` のテーブル定義を反映
  - Alembic マイグレーション or 初回実行スクリプトで投入
  - `alembic revision --autogenerate -m "initial"` → `alembic upgrade head`

- [ ] **アンカーデータの初期投入** — `pgvector.md` §3 の 6 カテゴリ分
  - Embedding を生成して `anchors` テーブルに INSERT

---

## AuthStack 関連

- [ ] **Google OAuth クライアント ID / Secret の取得** → Secrets Manager に登録
- [ ] **Apple Sign In の Service ID / Key の取得** → Secrets Manager に登録

---

## BatchStack 関連

- [ ] **OpenAI API Key** を Secrets Manager に登録
- [ ] **Google AI Studio Key** を Secrets Manager に登録

---

## デプロイ後の検証

- [ ] pgvector 拡張の有効化確認 (`SELECT * FROM pg_extension;`)
- [ ] EventBridge ルールの手動テスト実行
- [ ] Cognito テストユーザーでログインフロー確認
- [ ] API エンドポイントの疎通確認
